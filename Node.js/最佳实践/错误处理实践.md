# 错误处理实践

[参考资料](https://github.com/goldbergyoni/nodebestpractices#2-error-handling-practices) | [实践工程](https://github.com/fooins/insbiz/blob/main/src/libraries/error-handling.js)

对于 Node.js 程序的错误处理，主要需考虑以下几个要点：

1. 仅使用内置的 Error 对象：无论是拒绝 Promise 还是抛出异常，都使用内置的 Error 对象，或扩展自内置 Error 的对象，有利于提高一致性并防止信息丢失。否则将使错误处理逻辑和模块之间的互操作性变得复杂。

2. 集中处理错误：错误处理逻辑，应封装在一个专用且集中的对象中，当出现错误时，所有端点（例如中间件、cron 作业、单元测试）都会调用该对象。否则将导致代码重复，并可能导致不一致的错误处理机制。

3. 发生未知错误时优雅地退出进程：当发生未知错误（通常是开发人员错误）时，应用程序的健康状况存在不确定性。常见做法是使用 [Forever](https://www.npmjs.com/package/forever) 或 [PM2](https://pm2.keymetrics.io/) 等管理工具重新启动服务。

4. 始终处理 uncaughtException 事件：如果程序产生了一个异常而没有被任何 Try Catch 捕获则会触发 `uncaughtException` 事件，应该始终对该事件进行监听和处理。

5. 捕获未处理的 Promise 拒绝：大多数 Node.js 程序代码都在 Promise 中运行，令人惊讶的是，除非开发人员记得添加 .catch 子句，否则在这些地方引发的错误不会由 `uncaughtException` 事件捕获。所以，强烈建议监听并处理 `unhandledRejection` 事件，确保任何 Promise 拒绝都得到处理。
