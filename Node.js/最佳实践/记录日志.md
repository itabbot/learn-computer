# 日志实践

[参考资料一](https://github.com/goldbergyoni/nodebestpractices#-52-increase-transparency-using-smart-logging) | [参考资料二](https://github.com/goldbergyoni/nodebestpractices#-514-assign-a-transaction-id-to-each-log-statement) | [实践工程](https://github.com/fooins/insbiz)

在程序中打印日志是非常有必要的，这将非常有利于我们跟踪错误和统计分析（比如统计近期最慢的 API）。一个好的日志组件通常需要考虑以下几个方面：

- 日志级别：日志级别定义了该日志内容的重要程度，以便于我们能够进行针对性地处理。日志记录器往往会根据实际情况（比如环境的不同）对日志进行选择性记录。
- 日志格式：不同场景下的日志格式可能会有所差异。比如按行记录请求和响应的 API 访问日志，或使用结构化的（比如 JSON 格式）易于统计分析的日志。
- 错误日志：通常建议将错误日志单独记录，以便于快速处理。
- 跟踪标识：建议为每个请求/任务分配唯一的跟踪标识，并将其记录到每条日志中，当然也要传递给所调用的其他服务，以便于关联同个链路的相关日志内容。
- 检索工具：提供相关的命令行日志检索工具，以便于我们在服务器对不易阅读的日志内容（比如 JSON 格式）进行检索和展示。
- 敏感数据：日志中请勿记录敏感的信息，比如密钥、手机号码、用户姓名以及身份证号码等等。
- 日志大小：应杜绝不必要的日志，因为这会影响程序的性能、消耗更多的存储控件，同时也增加了处理的难度。**特别需要注意避免日志将磁盘写满导致服务异常的情况**。

目前比较流行的日志工具包有：

- [winston](https://www.npmjs.com/package/winston)
- [debug](https://www.npmjs.com/package/debug)
- [loglevel](https://www.npmjs.com/package/loglevel)
- [morgan](https://www.npmjs.com/package/morgan)
- [pino](https://www.npmjs.com/package/pino)
- [bunyan](https://www.npmjs.com/package/bunyan)
- [log4js](https://www.npmjs.com/package/log4js)
