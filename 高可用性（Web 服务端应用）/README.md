# 高可用性（Web 服务端应用）<!-- omit in toc -->

## 目录<!-- omit in toc -->

- [1. 概述](#1-概述)
- [2. 度量方式](#2-度量方式)
- [3. 实现方法](#3-实现方法)
  - [3.1. 服务器](#31-服务器)
  - [3.2. 网络接入组件](#32-网络接入组件)
  - [3.3. 数据库](#33-数据库)
  - [3.4. 消息队列](#34-消息队列)
  - [3.5. 应用程序](#35-应用程序)

## 1. 概述

可用性（英文：availability），指一个功能个体在提供服务期间维持其可工作状态的程度。比如一个在线电商平台，我们可以访问它、浏览商品、下单购买、提交评论等等，就可以认为这个电商平台是可用的，而如果我们无法访问它，从用户的角度来看，该电商平台是不可用的。

高可用性（英语：high availability，缩写为 HA），是功能个体的一个特征，表示该功能个体拥有高水平的可用性。也指功能个体无中断地维持其可工作状态的能力。

## 2. 度量方式

可用性的度量方式通常是：在一个给定的时间间隔内，一个功能个体处在可工作状态的时间的比例，即 `可用性 = 可工作状态的时间 / 总工作时间 * 100%`。比如在一周内（168 小时）有 100 小时可用的功能个体的可用性为 `100 / 168 * 100% = 59.52%`。

也有另一种度量方式是：根据功能个体无法使用的时间，以及由无法运作恢复到可运作状况的时间，与总运作时间的比较。计算公式为 `可用性 = 平均故障间隔 / (平均故障间隔 + 平均修复时间) * 100%`。

在高可用性的应用中，通常会使用一个被称为几个九的度量，对应小数点后 9 的个数。比如 “五个九”，相当于 0.99999（或者 99.999%）的可用性，如下表格所示：

| 可用性                  | 年故障时间  | 季度故障时间 | 月故障时间  | 周故障时间  | 天故障时间  |
| ----------------------- | ----------- | ------------ | ----------- | ----------- | ----------- |
| 99%（“两个九”）         | 3.65 天     | 21.9 小时    | 7.31 小时   | 1.68 小时   | 14.40 分钟  |
| 99.9%（“三个九”）       | 8.77 小时   | 2.19 小时    | 43.83 分钟  | 10.08 分钟  | 1.44 分钟   |
| 99.99%（“四个九”）      | 52.60 分钟  | 13.15 分钟   | 4.38 分钟   | 1.01 分钟   | 8.64 秒     |
| 99.999%（“五个九”）     | 5.26 分钟   | 1.31 分钟    | 26.30 秒    | 6.05 秒     | 864.00 毫秒 |
| 99.9999%（“六个九”）    | 31.56 秒    | 7.89 秒      | 2.63 秒     | 604.80 毫秒 | 86.40 毫秒  |
| 99.99999%（“七个九”）   | 3.16 秒     | 0.79 秒      | 262.98 毫秒 | 60.48 毫秒  | 8.64 毫秒   |
| 99.999999%（“八个九”）  | 315.58 毫秒 | 78.89 毫秒   | 26.30 毫秒  | 6.05 毫秒   | 864.00 微秒 |
| 99.9999999%（“九个九”） | 31.56 毫秒  | 7.89 毫秒    | 2.63 毫秒   | 604.80 微秒 | 86.40 微秒  |

## 3. 实现方法

实现高可用性的主要手段是数据或服务的冗余备份以及自动故障转移。比如服务故障，那就将服务切换到其他可用的服务上；如果是磁盘损坏，那就从备份的磁盘中读取数据。

一个 Web 服务端应用软件系统，通常由[应用程序](#35-应用程序)和各类组件构成，组件包括（但不限于）[网络接入组件](#32-网络接入组件)、[数据库](#33-数据库)、[消息队列](#34-消息队列)等等。想要实现一个整体高可用的软件系统，需要保障每个组成部分的高可用性。

软件系统的每个组成部分，都是运行在具体的[物理服务器](#31-服务器)之上的，所以服务器的可用性是实现整体高可用的关键。

### 3.1. 服务器

冗余备份：

- 集群部署。

故障转移：

- 通过负载均衡把请求转发到集群中的其他可用的服务器；
- 通过注册中心监控提供服务的服务器，一旦发现某个服务器不可用，立即通知客户端程序修改服务访问列表，剔除不可用的服务器。

### 3.2. 网络接入组件

- 负载均衡。[详细架构>>](../%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%88Web%20%E5%BA%94%E7%94%A8%EF%BC%89#4-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B)
  - 冗余备份：多部署几个冗余的组件，不如 Nginx 或 LVS。
  - 故障转移：通过比如 Keepalived 之类的工具实现自动切换。

### 3.3. 数据库

- [MySQL](./MySQL.md)

### 3.4. 消息队列

### 3.5. 应用程序

应用程序的扩展性主要依赖于[服务器](#31-服务器)（或容器）的可用性。
